---
title: iOS 内存分配与分区
categories: 
---

1. RAM ROM

	RAM：运行内存，不能掉电存储。
	ROM：存储性内存，可以掉电存储，例如内存卡、Flash。

	由于 RAM 类型不具备掉电存储能力（即一掉电数据消失），所以 app 程序一般存放于 ROM 中。RAM 的访问速度要远高于 ROM，价格也要高。
	
2. App程序启动

	App 程序启动，系统会把开启的那个 App 程序从 Flash 或 ROM 里面拷贝到内存（RAM），然后从内存里面执行代码。
	
	另一个原因是 CPU 不能直接从内存卡里面读取指令（需要 Flash 驱动等等）。

3. 内存分区：

	**栈区（stack）**
	
	- 存放的局部变量、先进后出、一旦出了作用域就会被销毁；
	- 函数跳转地址，现场保护等；
	- 程序员不需要管理栈区变量的内存；
	- 栈区地址从高到低分配；

	**堆区（heap）**
	
	- 堆区的内存分配使用的是 alloc；
	- 需要程序员管理内存；
	- ARC 的内存的管理，是编译器再便宜的时候自动添加 retain、release、autorelease；
	- 堆区的地址是从低到高分配

	**全局区／静态区（static）**
	
	- 包括两个部分：未初始化 、已初始化；
	- 全局区/静态区，在内存中是放在一起的，已初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域；

	**常量区**
	常量字符串就是放在这里。

	**代码区**
	存放 App 代码。
		
	如下图所示：代码区存放于低地址，栈区存放于高地址。区与区之间并不是连续的。

	<center>
	![](http://dzliving.com/Memery_1.png)
	</center>


4. 注意事项

	- 在 iOS 中，堆区的内存是应用程序共享的，堆中的内存分配是系统负责的；
	- 系统使用一个<font color=#cc0000>链表</font>来维护所有已经分配的内存空间（系统仅仅纪录，并不管理具体的内容）；
	- 变量使用结束后，需要释放内存，OC 中是根据引用计数来判断；
	- 当一个 app 启动后，代码区、常量区、全局区大小已固定，因此指向这些区的指针不会产生崩溃性的错误。而堆区和栈区是时时刻刻变化的（堆的创建销毁，栈的弹入弹出），所以当使用一个指针指向这两个区里面的内存时，一定要注意内存是否已经被释放，否则会产生程序崩溃（也即是野指针报错）。
   
5. 其它操作系统
	
	- iOS 是基于 UNIX、Android 是基于 Linux 的，在 Linux 和 unix 系统中，内存管理的方式基本相同；
	- Android 应用程序的内存分配也是如此。除此以外，这些应用层的程序使用的都是虚拟内存，它们都是建立在操作系统之上的，只有开发底层驱动或板级支持包时才会接触到物理内存，

	在嵌入式 Linux 中，实际的物理地址只有 64M 甚至更小，但是虚拟内存却可以高达 4G;