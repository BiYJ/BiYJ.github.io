---
title: Base64
---


## 一、Base64 编码由来

> 为什么会有 Base64 编码呢？

因为有些网络传送渠道并不支持所有的字节，例如传统的邮件只支持可见字符的传送，像 ASCII 码的控制字符就不能通过邮件传送。这样用途就受到了很大的限制，比如图片二进制流的每个字节不可能全部是可见字符，所以就传送不了。最好的方法就是在不改变传统协议的情况下，做一种扩展方案来支持二进制文件的传送。把不可打印的字符也能用可打印字符来表示，问题就解决了。Base64 编码应运而生，Base64 就是一种<font color=#cc0000>基于 64 个可打印字符来表示二进制数据的表示方法</font>。


## 二、Base64编码原理

看一下 Base64 的索引表，字符选用了 `A-Z、a-z、0-9、+、/` 64 个可打印字符。数值代表字符的索引，这个是标准 Base64 协议规定的，不能更改。

64 个字符用 6 个 bit 位就可以全部表示，一个字节有 8 个 bit 位，剩下两个 bit 就浪费掉了，这样就不得不牺牲一部分空间了。这里需要弄明白的就是一个 Base64 字符是 8 个 bit，但是<font color=#cc0000>有效部分只有右边的 6 个 bit，左边两个永远是 0</font>。

<center>
![](http://dzliving.com/base64_1)
</center>

> 那么怎么用 6 个有效 bit 来表示传统字符的 8 个 bit 呢？

8 和 6 的最小公倍数是 24，也就是说 3 个传统字节可以由 4 个 Base64 字符来表示，保证有效位数是一样的，这样就多了 1/3 的字节数来弥补 Base64 只有 6 个有效 bit 的不足。你也可以说用两个 Base64 字符也能表示一个传统字符，但是采用最小公倍数的方案其实是最能减少浪费的。

结合下边的图比较容易理解。Man 是三个字符，一共 24 个有效 bit，只好用 4 个 Base64 字符来凑齐 24 个有效位。红框表示的是对应的 Base64，6 个有效位转化成相应的索引值再对应 Base64 字符表，查出 "Man" 对应的 Base64 字符是 "TWFU"。

说到这里有个原则不知道你发现了没有，要转换成 Base64 的最小单位就是三个字节，对一个字符串来说每次都是三个字节三个字节的转换，对应的是 Base64 的四个字节。这个搞清楚了其实就差不多了。

<center>
![](http://dzliving.com/base64_2)
![](http://dzliving.com/base64_3)
</center>

         
但是转换到最后你发现不够三个字节了怎么办呢？

愿望终于实现了，我们可以用两个 Base64 来表示一个字符或用三个 Base64 表示两个字符，像下图的 A 对应的第二个 Base64 的二进制位只有两个，把后边的四个补 0 就是了。所以 A 对应的 Base64 字符就是 QQ。上边已经说过了，原则是 Base64 字符的最小单位是四个字符一组，那这才两个字符，后边补两个"="吧。其实不用"="也不耽误解码，之所以用"="，可能是考虑到多段编码后的Base64字符串拼起来也不会引起混淆。

由此可见 Base64 字符串只可能最后出现一个或两个"="，中间是不可能出现"="的。下图中字符"BC"的编码过程也是一样的。

<center>
![](http://dzliving.com/base64_4)
</center>

编码原理

> 将 3 个字节转换成 4 个字节 ((3 * 8) = 24 = (4 * 6))，先读入 3 个字节， 每读一个字节，左移8位，再右移四次，每次 6 位，这样就有 4 个字节了。

解码原理

> 将 4 个字节转换成 3 个字节，先读入 4 个 6 位（或运算），每次左移 6 位，再右移 3 次，每次 8 位，这样就还原了。 

## 三、总结　　

说起 Base64 编码可能有些奇怪，因为大多数的编码都是由字符转化成二进制的过程，而从二进制转成字符的过程称为解码。而 Base64 的概念就恰好反了，由二进制转到字符称为编码，由字符到二进制称为解码。
 Base64 编码主要用在传输、存储、表示二进制等领域，还可以用来加密，但是这种加密比较简单，只是一眼看上去不知道什么内容罢了，当然也可以对 Base64 的字符序列进行定制来进行加密。

Base64 编码是从二进制到字符的过程，像一些中文字符用不同的编码转为二进制时，产生的二进制是不一样的，所以最终产生的 Base64 字符也不一样。例如"上网"对应 utf-8 格式的 Base64 编码是 "5LiK572R"，对应 GB2312 格式的 Base64 编码是 "yc/N+A==“。
