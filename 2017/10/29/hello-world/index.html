<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> 四、Hello World		 | D</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style-dark.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight-dark.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden"> 四、Hello World		</h1><a id="logo" href="/.">D</a><p class="description">While there is life there is hope</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title"> 四、Hello World		</h1><div class="post-meta"><a href="/2017/10/29/hello-world/#comments" class="comment-count"></a><p><span class="date">Oct 29, 2017</span><span><a href="/categories/GLSL/" class="category">GLSL</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>原文：<a href="http://www.cnblogs.com/mazhenyu/p/5580951.html" target="_blank" rel="noopener">http://www.cnblogs.com/mazhenyu/p/5580951.html</a> 这一节中包含一个最基本的 shader，它提供如下功能：顶点变换然后使用单一的颜色渲染图元。 1<strong>、顶点 shader</strong>前面已经说过，顶点 shader 负责完成顶点变换。这里将按照固定功能的方程完成顶点变换。 固定功能流水线中一个顶点通过模型视图矩阵以及投影矩阵进行变换，使用如下公式：</p>
<ol>
<li>vTrans = projection <em> modelview </em> incomingVertex</li>
</ol>
<p>首先 GLSL 需要访问 OpenGL 状态，获得公式中的前两个矩阵。前面讲过，GLSL 可以获取某些 OpenGL 状态信息的，这两个矩阵当然包括在内。可以通过预先定义的一致变量来获取它们：</p>
<ol>
<li>uniform mat4 gl_ModelViewMatrix;</li>
<li><p>uniform mat4 gl_ProjectionMatrix;</p>
<p>接下来需要得到输入的顶点。通过预先定义的属性变量，所有的顶点将可以一个个传入顶点 shader 中。</p>
</li>
<li><p>attribute vec4 gl_Vertex;</p>
</li>
</ol>
<p>为了输出变换后的顶点，shader 必须写入预先定义的 vec4 型变量 gl_Position 中，注意这个变量没有修饰符。 现在我们可以写一个仅仅进行顶点变换的顶点 shader 了。注意所有其他功能都将丧失，比如没有光照计算。顶点 shader 必须有一个 main 函数，如下面的代码所示：</p>
<ol>
<li>void main()</li>
<li>{</li>
<li>gl_Position = gl_ProjectionMatrix <em> gl_ModelViewMatrix </em> gl_Vertex;</li>
<li>}</li>
</ol>
<p>上面代码中变换每个顶点时，投影矩阵都将乘上模型视图矩阵，这显然非常浪费时间，因为这些矩阵不是随每个顶点变化的。注意这些矩阵是<strong>一致变量</strong>。 GLSL 提供一些派生的矩阵，也就是说 gl_ModelViewProjectionMatrix 是上面两个矩阵的乘积，所以顶点 shader 也可以写成下面这样：</p>
<ol>
<li>void main()</li>
<li>{</li>
<li>gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;</li>
<li><p>}</p>
<p>上面的操作能够获得和固定功能流水线相同的结果吗？理论上是如此，但实际上对顶点变换操作的顺序可能会不同。顶点变换通常在显卡中是高度优化的任务，所以有一个利用了这种优化的特定函数用来处理这个任务。这个神奇的函数如下：</p>
</li>
<li><p>vec4 ftransform(void);</p>
</li>
</ol>
<p>使用这个函数的另一个原因是 float 数据类型的精度限制。由于数据精度的限制，当使用不同的顺序计算时，可能得到不同的结果，因此 GLSL 提供这个函数保证获得最佳性能的同时，还能得到与固定功能流水线相同的结果。 这个函数按照与固定功能相同的步骤对输入顶点进行变换，然后返回变换后的顶点。所以 shader 可以重新写成如下形式：</p>
<ol>
<li>void main()</li>
<li>{</li>
<li>gl_Position = ftransform();</li>
<li>}</li>
</ol>
<p><strong>2、片断 shader</strong> 片断 shader 也有预先定义的变量 gl_FragColor，可以向其中写入片断的颜色值。下面的代码就是一个片断 shader，将所有片断绘制成淡蓝色：</p>
<ol>
<li>void main()</li>
<li>{</li>
<li>gl_FragColor = vec4(0.4, 0.4, 0.8, 1.0);</li>
<li>}</li>
</ol>
<p>可以在此获得本节例子的源码：<a href="http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/glutglsl5_2.0.zip" target="_blank" rel="noopener">http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/glutglsl5_2.0.zip</a> <strong>3、颜色 shader</strong>GLSL 可以读取一些 OpenGL 状态，在本节我们将学习如何访问在 OpenGL 中设置的 glColor 变量。 GLSL 有一个属性变量记录当前颜色，也提供易变变量从顶点 shader 向片断 shader 传递颜色值。</p>
<ul>
<li>attribute vec4 gl_Color;</li>
<li>varying vec4 gl_FrontColor; // writable onthe vertex shader</li>
<li>varying vec4 gl_BackColor;  // writable onthe vertex shader</li>
<li>varying vec4 gl_Color;      // readable on thefragment shader</li>
</ul>
<p>变量使用思想如下：1、OpenGL 程序通过 glColor 传送颜色信息。2、顶点 shader 通过属性 gl_Color 接收颜色值。3、顶点 shader 计算正面和反面的颜色，然后分别保存在 gl_FrontColor 和 gl_BackColor 中。4、片断 shader 接收易变变量 gl_Color 中存储的插值产生的颜色，由当前图元的方向决定颜色是 gl_FrontColor 还是 gl_BackColor 插值产生的。5、片断 shader 根据易变变量 gl_Color 设置 gl_FragColor。 前面说过顶点 shader 和片断 shader 中传递的易变变量要有相同的名字，但这里是个例外，顶点 shader 中的 gl_FrontColor和 gl_BackColor 会根据图元的方向，自动转变为片断 shader 中的 gl_Color。还要注意属性变量gl_Color 和易变变量 gl_Color 没有冲突，因为前者只存在于顶点 shader，后者只存在于片断 shader。 下面是顶点 shader 的例子，只计算了正面颜色：</p>
<ol>
<li>void main()</li>
<li>{</li>
<li>gl_FrontColor = gl_Color;</li>
<li>gl_Position   = ftransform();</li>
<li><p>}</p>
<p>片断 shader 更加简单：</p>
</li>
<li><p>void main()</p>
</li>
<li>{</li>
<li>gl_FragColor = gl_Color;</li>
<li>}</li>
</ol>
<p>基于 GLEW 的源代码：<a href="http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/colorglut_2.0.zip" target="_blank" rel="noopener">http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/colorglut_2.0.zip</a> <strong>4、扁平 shader（Flatten Shader）</strong>着色器编程让我们可以探索一些新效果，本节的例子展示了用奇怪的方法操作顶点得到的效果。 首先我们要得到一个扁平的 3D 模型，只需要在应用模型视图变换时将模型顶点的 z 坐标设为 0 就行了。下面是顶点 shader 的代码：</p>
<ol>
<li>void main(void)</li>
<li>{</li>
<li>vec4 v = vec4(gl_Vertex);</li>
<li><p>v.z = 0.0;</p>
</li>
<li><p>gl_Position = gl_ModelViewProjectionMatrix * v;</p>
</li>
<li>}</li>
</ol>
<p>我们先将 gl_Vertex 变量复制到一个局部变量 v 中。gl_Vertex 是一个 GLSL 提供的属性变量，所以在顶点 shader 中它是只读的。 片断 shader 只用设置一种颜色。一个扁平的茶壶效果如下：<img src="http://hi.csdn.net/attachment/201107/27/0_131175714402Zj.gif" alt> 更进一步，我们需要在 z 坐标上使用一个正弦函数。将 z 坐标作为 x 坐标的函数，这样茶杯将呈现波浪的效果：</p>
<ol>
<li>void main(void)</li>
<li>{</li>
<li>vec4 v = vec4(gl_Vertex);</li>
<li>v.z = sin(5.0 <em> v.x) </em> 0.25;</li>
<li>gl_Position = gl_ModelViewProjectionMatrix * v;</li>
<li>}</li>
</ol>
<p>最后我们需要加入一些顶点动画效果。为了达到这个目的我们需要增加一个变量记录变化的时间，或者帧数。一个顶点 shader是无法记录不同顶点值的，更不用说记录不同的帧了。所以我们需要在 OpenGL 程序中定义这个变量，然后作为一致变量传递给 shader。假设在 OpenGL 程序中有一个名为 time 的 帧计数器，在 shader 中有个同名的一致变量。 顶点 shader 的代码如下：</p>
<ol>
<li><p>uniform float time;</p>
</li>
<li><p>void main(void)</p>
</li>
<li>{</li>
<li>vec4 v = vec4(gl_Vertex);</li>
<li>v.z = sin(5.0 <em> v.x + time </em> 0.01) * 0.25;</li>
<li>gl_Position = gl_ModelViewProjectionMatrix * v;</li>
<li>}</li>
</ol>
<p>在有关一致变量的小节讲过，在 OpenGL 程序中需要两个步骤：·   setup    获取一致变量的存储位置·   render   更新一致变量 设置(setup)步骤只有一条语句：</p>
<ol>
<li><p>loc = glGetUniformLocation(p, “time”);</p>
<p>这里 p 是程序的句柄，time 与顶点 shader 中定义的一致变量名称相同。变量 loc 是 Glint 类型的，必须定义在下面的渲染(render)函数也可以访问到的地方。渲染函数如下所示：</p>
</li>
<li><p>void renderScene(void)</p>
</li>
<li>{</li>
<li>glClear(GL_COLOR_BUFFER_BIT| GL_DEPTH_BUFFER_BIT);</li>
<li>glLoadIdentity();</li>
<li>gluLookAt( 0.0,  0.0,  5.0,</li>
<li>0.0,  0.0,  0.0,</li>
<li>0.0f, 1.0f, 0.0f);</li>
<li><p>glUniform1f(loc, time);</p>
</li>
<li><p>glutSolidTeapot(1);</p>
</li>
<li>time += 0.01;</li>
<li>glutSwapBuffers();</li>
<li>}</li>
</ol>
<p>函数中的变量 time 在程序一开始初始化，然后每帧都会进行自增运算。 本节的 GLEW 源代码：<a href="http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/flatten_2.0.zip" target="_blank" rel="noopener">http://lighthouse3d.com/wptest/wp-content/uploads/2011/03/flatten_2.0.zip</a></p>
</div><div class="post-copyright"><blockquote><p>原文作者: BiYJ</p><p>原文链接: <a href="http://yoursite.com/2017/10/29/hello-world/">http://yoursite.com/2017/10/29/hello-world/</a></p><p>版权声明: 转载请注明出处(必须保留原文作者署名原文链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2017/10/30/e4-ba-94-e3-80-81-e5-8d-a1-e9-80-9a-e7-9d-80-e8-89-b2/" class="pre"> 五、卡通着色		</a><a href="/2017/10/27/e4-b8-89-e3-80-81-e5-9c-a8opengl-e4-b8-ad-e5-90-91shader-e4-bc-a0-e9-80-92-e4-bf-a1-e6-81-af/" class="next"> 三、在OpenGL中向shader传递信息		</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/06/13/WKWebView/">WKWebView</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/iOS 编译过程原理(2)/">iOS 编译过程原理(2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/BFPRT算法/">BFPRT 算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/全排列/">全排列</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/01-背包/">0-1 背包</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/直接插入排序/">直接插入排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/armv7、armv7s、arm64/">armv7、armv7s、arm64</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/Archives配置/">Archives 配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/App-Thinning/">App Thinning</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/23/AFNetworking/">AFNetworking</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AFNetworking/">AFNetworking</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GLSL/">GLSL</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Games/">Games</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Leetcode/">Leetcode</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MJRefresh/">MJRefresh</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OC/">OC</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OPENGL/">OPENGL</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactiveCocoa/">ReactiveCocoa</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SDWebImage/">SDWebImage</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpriteKit/">SpriteKit</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Xcode/">Xcode</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内存管理/">内存管理</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/减治法/">减治法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分治法/">分治法</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/动态规划/">动态规划</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/变治法/">变治法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/图像视频/">图像视频</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习笔记/">学习笔记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工程发布/">工程发布</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/底层原理/">底层原理</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/性能优化/">性能优化</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/排序算法/">排序算法</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/效率-工具/">效率 | 工具</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据存储/">数据存储</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构设计/">架构设计</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法相关/">算法相关</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络编程/">网络编程</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/视图-amp-动画/">视图 &amp; 动画</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计策略/">设计策略</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/阅读源码/">阅读源码</a><span class="category-list-count">8</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/排序算法/" style="font-size: 15px;">排序算法</a> <a href="/tags/动态规划/" style="font-size: 15px;">动态规划</a> <a href="/tags/分治法/" style="font-size: 15px;">分治法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://www.liaoxuefeng.com/" title="廖雪峰的官方网站" target="_blank">廖雪峰的官方网站</a><ul></ul><a href="https://blog.ibireme.com/" title="ibireme" target="_blank">ibireme</a><ul></ul><a href="https://www.cnblogs.com/machao/" title="马在路上" target="_blank">马在路上</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">BiYJ.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>